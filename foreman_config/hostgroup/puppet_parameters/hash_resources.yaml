--- # resources
### Dateien
file:
  # keytab für Active Directory-Join
  krb-keytab:
    path: /tmp/.kr922392
    owner: root
    group: root
    mode: '0400'
    source: puppet:///modules/fsphys/keytab
    notify: Class[realmd::join::keytab]
  # Citrix Receiver als .deb-Paket
  citrix-receiver-deb:
    path: /tmp/icaclient.deb
    source: puppet:///modules/fsphys/icaclient_13.6.0.10243651_amd64.deb
  # Vorgabe-Dateien für persönliche Ordner in /etc/skel/ anlegen
  /etc/skel:
    ensure: directory
    recurse: remote
    links: manage
    source: puppet:///modules/fsphys/etc/skel
  # Ausführen eines Skripts bei jedem Login (/etc/profile.d/)
  /etc/profile.d/fsphys.sh:
    source: puppet:///modules/fsphys/etc/profile.d/fsphys.sh
  # WWU-Schrift (FontFont Meta Office Pro) installieren
  /usr/local/share/fonts/ff-meta:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/usr/local/share/fonts/ff-meta
    notify: Exec[update-font-cache-local]
  # Globale Firefox-Einstellungen
  /usr/lib/firefox/distribution:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/usr/lib/firefox/distribution
    # Firefox-Konfiguration kann erst angelegt werden, nachdem Firefox
    # installiert wurde
    require: Package[firefox]
  # FSPHYS-spezifische Ressourcen
  /srv/fsphys:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/srv/fsphys

# Dummy-Nutzer anlegen um zu verhindern, dass gnome-initial-setup nach der
# Installation ausgeführt wird
user:
  disable-gis:
    ensure: present
    managehome: true

### Befehle
exec:
  update-font-cache-local:
    command: fc-cache -f /usr/local/share/fonts/
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
  # Citrix Receiver via dpkg installieren
  # Dies muss per „exec“ (statt „package“) durchgeführt werden, damit die
  # Option
  # -E (--skip-same-version) angegeben werden kann
  install-icaclient:
    command: dpkg -E -i /tmp/icaclient.deb
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
    subscribe: File[citrix-receiver-deb]

### Periodische Skripte (cron)
cron:
  # Gruppe jedes Home-Verzeichnisses einmalig auf p0fsphys ändern
  homedir-set-group:
    command: /srv/fsphys/homedir-set-group.sh
    user: root
    hour: 1
    require: File[/srv/fsphys]

### GNOME-Einstellungen
gnome::gsettings:
  # Benachrichtigungen über Software-Updates deaktivieren (Updates werden
  # automatisch durch das Paket „unattended-upgrades“ installiert)
  disable-update-notifications:
    schema: com.ubuntu.update-notifier
    key: no-show-notifications
    value: true
  # Knopf zum Ausloggen anzeigen
  show-logout:
    schema: org.gnome.shell
    key: always-show-log-out
    value: true
  # Begrüßungstext auf dem Login-Bildschirm anzeigen
  login-banner-enable:
    schema: org.gnome.login-screen
    key: banner-message-enable
    value: true
  login-banner-text:
    schema: org.gnome.login-screen
    key: banner-message-text
    value: "'Willkommen am Fachschafts-PC!'"
  login-logo:
    schema: org.gnome.login-screen
    key: logo
    value: "'/srv/fsphys/login-screen-logo.png'"
    require: File[/srv/fsphys]
  # Desktop-Hintergrundbild
  desktop-background:
    schema: org.gnome.desktop.background
    key: picture-uri
    value: "'file:///srv/fsphys/desktop-background.jpg'"
    require: File[/srv/fsphys]
  # Programme in der Seitenleiste („Dash“/„Favoriten“) der GNOME Shell
  launcher-apps:
    schema: org.gnome.shell
    key: favorite-apps
    value: "['nautilus.desktop', 'firefox.desktop', 'thunderbird.desktop', 'texstudio.desktop', 'libreoffice-startcenter.desktop', 'yelp.desktop']"

### Software-Pakete
package:
  # Citrix Receiver via gdebi installieren
  # TODO- Dies sorgt dafür, dass das Paket jedes Mal neu installiert wird, wenn
  #       Puppet ausgeführt wird (Provider dpkg hat leider dasselbe Problem).
  #       S. auch
  #       https://answers.launchpad.net/ubuntu/+source/gdebi/+question/658069
#  citrix-receiver:
#    provider: gdebi
#    source: /tmp/icaclient.deb
#    require: File[citrix-receiver-deb]
  ## Pakete zur Installation via APT
  ## Utility (Kommandozeile)
  # xmllint installieren, bevor pam_mount aktiviert wird
  # pam_mount verwendet xmllint, um die Konfigurationsdatei pam_mount.conf.xml
  # zu validieren
  # =============
  # Abhängigkeiten von Citrix Receiver
  libjavascriptcoregtk-1.0-0:
    ensure: present
    before: Exec[install-icaclient]
  libwebkitgtk-1.0-0:
    ensure: present
    before: Exec[install-icaclient]
  # =============
  libxml2-utils:
    ensure: present
    before: Class[pam_mount]
  # cifs-utils installieren, bevor pam_mount aktiviert wird
  # mount.cifs wird benötigt, um Netzlaufwerke der IVV4 einzubinden
  cifs-utils:
    ensure: present
    before: Class[pam_mount]
  # keyutils installieren, bevor pam_mount aktiviert wird
  # keyutils wird benötigt, um beim Einbinden von CIFS-Dateisystemen
  # DFS-Umleitungen (z.B. auf //nwz.wwu.de/dfs/) verarbeiten zu können
  # S. auch https://bugs.launchpad.net/ubuntu/+source/samba/+bug/493565
  keyutils:
    ensure: present
    before: Class[pam_mount]
  gnupg2:
    ensure: present
  curl:
    ensure: present
  wget:
    ensure: present
  tree:
    ensure: present
  unp:
    ensure: present
  wine-stable:
    ensure: present
  # PDF-Werkzeuge
  ghostscript:
    ensure: present
  pdftk:
    ensure: present
  pdf2svg:
    ensure: present
  pdfgrep:
    ensure: present
  poppler-utils:
    ensure: present
  libpodofo-utils:
    ensure: present
  imagemagick:
    ensure: present
  ## Desktop
  ubuntu-gnome-desktop:
    ensure: present
  ## Utility (GUI)
  gnuplot5-qt:
    ensure: present
  keepass2:
    ensure: present
  virtualbox-qt:
    ensure: present
  ## Office
  libreoffice:
    ensure: present
  texlive-full:
    ensure: present
  texstudio:
    ensure: present
  lyx:
    ensure: present
  gedit-plugins:
    ensure: present
  okular:
    ensure: present
  pdfchain:
    ensure: present
  pdfshuffler:
    ensure: present
  scribus:
    ensure: present
  ## Internet
  firefox:
    ensure: present
  torbrowser-launcher:
    ensure: present
  chromium-browser:
    ensure: present
  thunderbird:
    ensure: present
  xul-ext-ubufox:
    ensure: purged
  xul-ext-ublock-origin:
    ensure: present
  enigmail:
    ensure: present
  owncloud-client:
    ensure: present
  nautilus-owncloud:
    ensure: present
  filezilla:
    ensure: present
  ## Media
  vlc:
    ensure: present
  gimp:
    ensure: present
  krita:
    ensure: present
  inkscape:
    ensure: present
  blender:
    ensure: present
  audacity:
    ensure: present
  ## Programmierung
  git-all:
    ensure: present
  colordiff:
    ensure: present
  wdiff:
    ensure: present
  ipython3:
    ensure: present
  jupyter-notebook:
    ensure: present
  default-jdk:
    ensure: present
  php-cli:
    ensure: present

