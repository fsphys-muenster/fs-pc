--- # resources
### Dateien
file:
  # Einstellungen für sudo
  /etc/sudoers.d/fsphys:
    owner: root
    group: root
    mode: '0440'
    source: puppet:///modules/fsphys/etc/sudoers.d/fsphys
  # Vorgabe-Dateien für persönliche Ordner in /etc/skel/ anlegen
  /etc/skel:
    ensure: directory
    recurse: remote
    links: manage
    ignore: .gitkeep
    source: puppet:///modules/fsphys/etc/skel
  # Einstellungen für den Display-Manager (GDM)
  /var/lib/gdm3/.config:
    ensure: directory
    recurse: remote
    links: manage
    source: puppet:///modules/fsphys/var/lib/gdm3/.config
  # Einstellungen für PAM-Authentifizierung (/usr/share/pam-configs/)
  # (Zur Zeit verwendet, um Nutzergruppe neuer Home-Verzeichnisse auf p0fsphys
  # zu setzen)
  # S. auch https://wiki.ubuntu.com/PAMConfigFrameworkSpec
  /usr/share/pam-configs:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/usr/share/pam-configs
  # Ausführen eines Skripts bei jedem Login (/etc/profile.d/)
  /etc/profile.d/fsphys.sh:
    source: puppet:///modules/fsphys/etc/profile.d/fsphys.sh
  # WWU-Schrift (FontFont Meta Office Pro) installieren
  # S. auch
  # https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/desktop_migration_and_administration_guide/configure-fonts
  /usr/local/share/fonts/ff-meta:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/usr/local/share/fonts/ff-meta
    notify: Exec[update-font-cache-local]
  # Globale Firefox-Einstellungen
  /usr/lib/firefox/distribution:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/usr/lib/firefox/distribution
    # Firefox-Konfiguration kann erst angelegt werden, nachdem Firefox
    # installiert wurde
    require: Package[firefox]
  # FSPHYS-spezifische Ressourcen
  /srv/fsphys:
    ensure: directory
    recurse: remote
    source: puppet:///modules/fsphys/srv/fsphys
  # Skripte sollen ausführbar sein
  /srv/fsphys/homedir-set-group.sh:
    mode: '0744'
    source: puppet:///modules/fsphys/srv/fsphys/homedir-set-group.sh
  # Drucker-Konfiguration (Drucken mit Kerberos-Zugangsdaten)
  /usr/lib/x86_64-linux-gnu/samba/smbspool_krb5_wrapper:
    mode: '0700'
    owner: root
    group: root
    require: Package[samba]
  /usr/lib/cups/backend/smb:
    ensure: link
    target: /usr/lib/x86_64-linux-gnu/samba/smbspool_krb5_wrapper
    require: Package[cups]

# Dummy-Nutzer anlegen um zu verhindern, dass gnome-initial-setup nach der
# Installation ausgeführt wird
user:
  disable-gis:
    ensure: present
    managehome: true

### Befehle
exec:
  pam-auth-update:
    command: pam-auth-update --package
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
    require: File[/srv/fsphys]
    subscribe: File[/usr/share/pam-configs]
  update-font-cache-local:
    command: fc-cache -f /usr/local/share/fonts/
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
  # Citrix Receiver via APT installieren
  install-icaclient:
    command: apt-get install /srv/fsphys/icaclient.deb
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
    subscribe: File[/srv/fsphys]
  # Dell-Druckertreiber für Dell Color MFP S2825cdn via APT installieren
  install-dell-printer-driver:
    command: apt-get install /srv/fsphys/dell-color-mfp-s2825cdn.deb
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
    subscribe: File[/srv/fsphys]
  # sejda (PDF-Werkzeug) installieren
  install-icaclient:
    command: apt-get install /srv/fsphys/sejda-console.deb
    path: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    user: root
    refreshonly: true
    subscribe: File[/srv/fsphys]

### GNOME-Einstellungen
gnome::gsettings:
  # Liste der aktivierten Shell-Erweiterungen
  enabled-extensions:
    schema: org.gnome.shell
    key: enabled-extensions
    value: "['LogOutButton@kyle.aims.ac.za']"
    require: Package[gnome-shell-extension-log-out-button]
  # Benachrichtigungen über Software-Updates deaktivieren (Updates werden
  # automatisch durch das Paket „unattended-upgrades“ installiert)
  disable-update-notifications:
    schema: com.ubuntu.update-notifier
    key: no-show-notifications
    value: true
  # Knopf zum Ausloggen anzeigen
  show-logout:
    schema: org.gnome.shell
    key: always-show-log-out
    value: true
  # Achtung! Das Logo wird so skaliert, dass es eine Höhe von 48px hat!
  # S.
  # https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/desktop_migration_and_administration_guide/customizing-login-screen
#  login-logo:
#    schema: org.gnome.login-screen
#    key: logo
#    value: "'/srv/fsphys/login-screen-logo.png'"
#    require: File[/srv/fsphys]
#  # Desktop-Hintergrundbild
#  desktop-background:
#    schema: org.gnome.desktop.background
#    key: picture-uri
#    value: "'file:///srv/fsphys/desktop-background.jpg'"
#    require: File[/srv/fsphys]
  # Programme in der Seitenleiste („Dash“/„Favoriten“) der GNOME Shell
  launcher-apps:
    schema: org.gnome.shell
    key: favorite-apps
    value: "['nautilus.desktop', 'firefox.desktop', 'thunderbird.desktop', 'texstudio.desktop', 'libreoffice-startcenter.desktop', 'yelp.desktop']"

### Software-Pakete
package:
  ## Pakete zur Installation via APT
  # Citrix Receiver von lokaler .deb-Datei installieren
  # TODO- Dies sorgt dafür, dass das Paket jedes Mal neu installiert wird, wenn
  #       Puppet ausgeführt wird (Provider dpkg und gdebi haben leider dasselbe
  #       Problem).
  #  citrix-receiver:
  #    source: /srv/fsphys/icaclient.deb
  #    subscribe: File[/srv/fsphys]
  ## Utility (Kommandozeile)
  # xmllint installieren, bevor pam_mount aktiviert wird
  # Das Puppet-Modul pam_mount verwendet xmllint, um die Konfigurationsdatei
  # pam_mount.conf.xml zu validieren
  libxml2-utils:
    ensure: present
    before: Class[pam_mount]
  # cifs-utils installieren, bevor pam_mount aktiviert wird
  # mount.cifs wird benötigt, um Netzlaufwerke der IVV4 einzubinden
  cifs-utils:
    ensure: present
    before: Class[pam_mount]
  # keyutils installieren, bevor pam_mount aktiviert wird
  # keyutils wird benötigt, um beim Einbinden von CIFS-Dateisystemen
  # DFS-Umleitungen (z.B. auf //nwz.wwu.de/dfs/) verarbeiten zu können
  # S. auch https://bugs.launchpad.net/ubuntu/+source/samba/+bug/493565
  keyutils:
    ensure: present
    before: Class[pam_mount]
  samba:
    ensure: present
  smbclient:
    ensure: present
  gnupg2:
    ensure: present
  curl:
    ensure: present
  wget:
    ensure: present
  tree:
    ensure: present
  p7zip:
    ensure: present
  unp:
    ensure: present
  rdesktop:
    ensure: present
  wine-stable:
    ensure: present
  # PDF-Werkzeuge
  ghostscript:
    ensure: present
  pdftk:
    ensure: present
  pdf2svg:
    ensure: present
  pdfgrep:
    ensure: present
  poppler-utils:
    ensure: present
  libpodofo-utils:
    ensure: present
  imagemagick:
    ensure: present
  ## Desktop
  ubuntu-desktop:
    ensure: present
  language-pack-de:
    ensure: present
  gnome-shell-extension-log-out-button:
    ensure: present
  ## Utility (GUI)
  gnuplot5-qt:
    ensure: present
  keepass2:
    ensure: present
  remmina:
    ensure: present
  virtualbox-qt:
    ensure: present
  ## Office
  libreoffice:
    ensure: present
  libreoffice-l10n-de:
    ensure: present
  libreoffice-help-de:
    ensure: present
  texlive-full:
    ensure: present
  texstudio:
    ensure: present
  lyx:
    ensure: present
  gedit-plugins:
    ensure: present
  okular:
    ensure: present
  pdfchain:
    ensure: present
  pdfshuffler:
    ensure: present
  scribus:
    ensure: present
  ## Internet
  firefox:
    ensure: present
  firefox-locale-de:
    ensure: present
  torbrowser-launcher:
    ensure: present
  chromium-browser:
    ensure: present
  thunderbird:
    ensure: present
  thunderbird-locale-de:
    ensure: present
  xul-ext-ubufox:
    ensure: purged
  xul-ext-ublock-origin:
    ensure: present
  enigmail:
    ensure: present
  owncloud-client:
    ensure: present
  nautilus-owncloud:
    ensure: present
  filezilla:
    ensure: present
  ## Media
  vlc:
    ensure: present
  gimp:
    ensure: present
  gimp-help-de:
    ensure: present
  krita:
    ensure: present
  inkscape:
    ensure: present
  blender:
    ensure: present
  audacity:
    ensure: present
  ## Programmierung
  git-all:
    ensure: present
  colordiff:
    ensure: present
  wdiff:
    ensure: present
  ipython3:
    ensure: present
  jupyter-notebook:
    ensure: present
  default-jdk:
    ensure: present
  php-cli:
    ensure: present

